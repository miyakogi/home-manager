# *** Set Variables ***
$run = app2unit
$mainMod = SUPER
$left = H
$right = L
$up = K
$down = J

# *** Source Colors ***
source=~/.config/hypr/kanagawa-dragon.conf

# *** Environment ***
env = GTK_THEME,Adwaita:dark
env = GTK_USE_PORTAL,1

env = QT_QPA_PLATFORM,wayland;xcb
env = QT_QPA_PLATFORMTHEME,qt6ct

env = XMODIFIERS,@im=fcitx
env = GTK_IM_MODULE,fcitx
env = QT_IM_MODULE,fcitx
env = GLFW_IM_MODULE,fcitx

env = GST_VAAPI_ALL_DRIVARS,1
env = APP2UNIT_SLICES,a=app-graphical.slice b=background-graphical.slice s=session-graphical.slice

env = AQ_NO_MODIFIERS,1
env = TERMINAL,kitty

env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland


exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
# exec-once = dbus-update-active-environment --systemd DISPLAY WAYLAND_DISPLAY
exec-once = dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY HYPRLAND_INSTANCE_SIGNATURE XDG_CURRENT_DESKTOP
exec-once = systemctl --user start hyprland-graphical-session.target
# exec-once = systemctl --user start graphical-session.target

# *** Monitors ***
monitorv2 {
  output = DP-2
  mode = 3840x2160@120
  position = 0x0
  scale = 1
  bitdepth = 10
  cm = srgb
  sdrbrightness = 1.07
  sdrsaturation = 1.15
  supports_wide_color = 1
  supports_hdr = 1
  sdr_min_luminance = 0.005
  sdr_max_luminance = 225
  min_luminance = 0
  max_luminance = 1000
  max_avg_luminance = 200
}

monitorv2 {
  output = HDMI-A-3
  mode = preferred
  position = 640x2160
  scale = 1
  vrr = 0
  bitdepth = 10
  cm = srgb
}

misc {
  vfr = false
  vrr = 0  # 0: off, 1: on, 2: fullscreen only
  mouse_move_enables_dpms = true
  key_press_enables_dpms = true
  focus_on_activate = false
  disable_splash_rendering = true
}

xwayland {
  force_zero_scaling = true
}

render {
  direct_scanout = 1
}

experimental {
  xx_color_management_v4 = true
}

# *** polkit ***
exec-once = hyprctl dispatch exec ~/.nix-profile/libexec/hyprpolkitagent
# exec-once = hyprctl dispatch exec "$run -s b -t service" -- ~/.nix-profile/libexec/hyprpolkitagent

# *** Status Bar ***
exec-once = hyprctl dispatch exec "$run -s b -a qs" -- nixGL qs -c qs-dots
# exec-once = hyprctl dispatch exec "$run -s b -t service -a waybar" -- nixGL waybar

# *** Wallpaper ***
exec-once = hyprctl dispatch exec "$run -s b -t service" -- hyprpaper

# *** Notification ***
exec-once = hyprctl dispatch exec "$run -s b -t service" -- mako

# *** LogSeq ***
exec-once = hyprctl dispatch exec "$run -s b -t service -a logseq" -- nixGL flatpak run com.logseq.Logseq --force-device-scale-factor=1.5

# *** Cursor Theme ***
cursor {
  no_hardware_cursors = false
  enable_hyprcursor = true
  default_monitor = DP-2
}

# *** Keyboard / Mouse ***
input {
  kb_layout = us
  kb_variant =
  kb_model =
  kb_rules =

  follow_mouse = 1

  repeat_delay = 240
  repeat_rate = 42

  touchpad {
    natural_scroll = true
  }
}

gestures {
  workspace_swipe_distance = 100
  workspace_swipe_create_new = false
}

# for CoolerMaster MM720
device {
  name = cooler-master-technology-inc.-mm720-gaming-mouse
  sensitivity = 0.0  # -1.0 - 1.0, 0 means no modification.
  accel_profile = flat
  natural_scroll = true
}

# for CoolerMaster MM710
device {
  name = cooler-master-technology-inc.-mm710-gaming-mouse
  sensitivity = 0.0  # -1.0 - 1.0, 0 means no modification.
  accel_profile = flat
  natural_scroll = true
}

# For Glorious Model D
device {
  name = glorious-model-d
  sensitivity = 0.0  # -1.0 - 1.0, 0 means no modification.
  accel_profile = flat
  natural_scroll = true
}

# For Perixx Touchpad
device {
  name = sino-wealth-peripad-506-touchpad
  sensitivity = 0.4
  scroll_method = 2fg
  disable_while_typing = false
  scroll_factor = 0.5
}

# *** Window Management ***
general {
  gaps_in = 8
  gaps_out = 24,16,16,16
  border_size = 2
  col.active_border = $green
  col.inactive_border = $comment

  no_focus_fallback = true

  layout = dwindle
}

decoration {
  rounding = 24

  blur {
    enabled = true
    size = 3
    passes = 2
    new_optimizations = true
  }

  shadow {
    enabled = true
    range = 24
    render_power = 3
    color = $green
    color_inactive = 0x80ffffff
  }

  dim_inactive = false
  dim_strength = 0.1
}

# disable blur for all normal windows by default
windowrule = noblur, class:.*

animations {
  enabled = true

  bezier = Linear, 0, 0, 0.5, 1
  bezier = easeInOutSine, 0, 0.69, 1, 0.43
  bezier = overInOutSine, 0, 0.3, -0.8, 1.6

  animation = windowsIn, 1, 1.2, Linear, popin 50%
  animation = windowsOut, 1, 1.2, Linear, popin 50%
  animation = windowsMove, 1, 1.5, Linear
  animation = border, 0, 1.2, Linear
  animation = borderangle, 0, 20, Linear, loop
  animation = fade, 0, 1, default
  animation = workspaces, 1, 1.2, Linear, slidevert
}

dwindle {
  pseudotile = false
  preserve_split = false
  force_split = 2
}

# *** Keybinding ***
# Basic binds, see https://wiki.hyprland.org/Configuring/Binds/ for more
bind = $mainMod, RETURN, exec, hyprctl dispatch exec $run -- nixGL kitty
bind = $mainMod, Q, killactive
bind = $mainMod, W, killactive
bind = $mainMod SHIFT, E, exec, leave
bind = $mainMod SHIFT, R, exec, systemctl --user restart waybar-hyprland.service
bind = $mainMod, F, fullscreen
bind = $mainMod SHIFT, F, togglefloating

# Logseq
bind = $mainMod, E, togglespecialworkspace, logseq
# Scratchpad Terminal
bind = , F2, exec, hypr-scratchterm

# *** Launcher ***
# fuzzel
bind = $mainMod, D, exec, fuzzel --launch-prefix='app2unit --fuzzel-compat --'
# tofi
bind = $mainMod, Space, exec, tofi-drun --drun-launch=false --anchor=center --background-color=000000AA | xargs --no-run-if-empty hyprctl dispatch exec $run --
# tofi (web search)
bind = $mainMod CONTROL, Space, exec, hyprctl dispatch exec $run -- tofi-web
# sklauncher
bind = $mainMod, S, exec, $run -- launch-menu

# Move focus with mainMod + arrow keys
bind = $mainMod, $left, movefocus, l
bind = $mainMod, $right, movefocus, r
bind = $mainMod, $up, movefocus, u
bind = $mainMod, $down, movefocus, d
bind = $mainMod, Left, movefocus, l
bind = $mainMod, Right, movefocus, r
bind = $mainMod, Up, movefocus, u
bind = $mainMod, Down, movefocus, d

# Move window position
bind = $mainMod SHIFT, $left, movewindow, l
bind = $mainMod SHIFT, $right, movewindow, r
bind = $mainMod SHIFT, $up, movewindow, u
bind = $mainMod SHIFT, $down, movewindow, d
bind = $mainMod SHIFT, Left, movewindow, l
bind = $mainMod SHIFT, Right, movewindow, r
bind = $mainMod SHIFT, Up, movewindow, u
bind = $mainMod SHIFT, Down, movewindow, d

# Define workspace names
$ws01 = 1
$ws02 = 2
$ws03 = 3
$ws04 = 4
$ws05 = 5
$ws06 = 6
$ws07 = 7
$ws08 = 8
$ws09 = 9
$ws10 = 10
$ws11 = 11
$ws12 = 12
$ws13 = 13
$ws14 = 14
$ws15 = 15
$ws16 = 16
$ws17 = 17
$ws18 = 18
$ws19 = 19
$ws20 = 20

# Switch workspaces with mainMod + [0-9]
bind = $mainMod, 1, workspace, $ws01
bind = $mainMod, 2, workspace, $ws02
bind = $mainMod, 3, workspace, $ws03
bind = $mainMod, 4, workspace, $ws04
bind = $mainMod, 5, workspace, $ws05
bind = $mainMod, 6, workspace, $ws06
bind = $mainMod, 7, workspace, $ws07
bind = $mainMod, 8, workspace, $ws08
bind = $mainMod, 9, workspace, $ws09
bind = $mainMod, 0, workspace, $ws10
bind = $mainMod CONTROL, 1, workspace, $ws11
bind = $mainMod CONTROL, 2, workspace, $ws12
bind = $mainMod CONTROL, 3, workspace, $ws13
bind = $mainMod CONTROL, 4, workspace, $ws14
bind = $mainMod CONTROL, 5, workspace, $ws15
bind = $mainMod CONTROL, 6, workspace, $ws16
bind = $mainMod CONTROL, 7, workspace, $ws17
bind = $mainMod CONTROL, 8, workspace, $ws18
bind = $mainMod CONTROL, 9, workspace, $ws19
bind = $mainMod CONTROL, 0, workspace, $ws20

workspace = $ws01, monitor:DP-2, default:true
workspace = $ws02, monitor:DP-2
workspace = $ws03, monitor:DP-2
workspace = $ws04, monitor:DP-2
workspace = $ws05, monitor:DP-2
workspace = $ws06, monitor:DP-2
workspace = $ws07, monitor:DP-2
workspace = $ws08, monitor:DP-2
workspace = $ws09, monitor:DP-2
workspace = $ws10, monitor:DP-2
workspace = $ws11, monitor:HDMI-A-3, default:true
workspace = $ws12, monitor:HDMI-A-3
workspace = $ws13, monitor:HDMI-A-3
workspace = $ws14, monitor:HDMI-A-3
workspace = $ws15, monitor:HDMI-A-3
workspace = $ws16, monitor:HDMI-A-3
workspace = $ws17, monitor:HDMI-A-3
workspace = $ws18, monitor:HDMI-A-3
workspace = $ws19, monitor:HDMI-A-3
workspace = $ws20, monitor:HDMI-A-3

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, movetoworkspace, $ws01
bind = $mainMod SHIFT, 2, movetoworkspace, $ws02
bind = $mainMod SHIFT, 3, movetoworkspace, $ws03
bind = $mainMod SHIFT, 4, movetoworkspace, $ws04
bind = $mainMod SHIFT, 5, movetoworkspace, $ws05
bind = $mainMod SHIFT, 6, movetoworkspace, $ws06
bind = $mainMod SHIFT, 7, movetoworkspace, $ws07
bind = $mainMod SHIFT, 8, movetoworkspace, $ws08
bind = $mainMod SHIFT, 9, movetoworkspace, $ws09
bind = $mainMod SHIFT, 0, movetoworkspace, $ws10
bind = $mainMod SHIFT CONTROL, 1, movetoworkspace, $ws11
bind = $mainMod SHIFT CONTROL, 2, movetoworkspace, $ws12
bind = $mainMod SHIFT CONTROL, 3, movetoworkspace, $ws13
bind = $mainMod SHIFT CONTROL, 4, movetoworkspace, $ws14
bind = $mainMod SHIFT CONTROL, 5, movetoworkspace, $ws15
bind = $mainMod SHIFT CONTROL, 6, movetoworkspace, $ws16
bind = $mainMod SHIFT CONTROL, 7, movetoworkspace, $ws17
bind = $mainMod SHIFT CONTROL, 8, movetoworkspace, $ws18
bind = $mainMod SHIFT CONTROL, 9, movetoworkspace, $ws19
bind = $mainMod SHIFT CONTROL, 0, movetoworkspace, $ws20

# Switch workspace
bind = $mainMod, bracketleft, workspace, m-1
bind = $mainMod, bracketright, workspace, m+1
bind = $mainMod, Tab, workspace, m+1
bind = $mainMod SHIFT, Tab, workspace, m-1
bind = $mainMod CONTROL, left, workspace, m-1
bind = $mainMod CONTROL, right, workspace, m+1
bind = $mainMod, O, workspace, m-1
bind = $mainMod, P, workspace, m+1
gesture = 3, left, dispatcher, workspace, m+1
gesture = 3, right, dispatcher, workspace, m-1
gesture = 3, down, dispatcher, exec, ydotool key 29:1 17:1 17:0 29:0
gesture = 3, up, dispatcher, exec, ydotool key 29:1 19:1 19:0 29:0
gesture = 4, vertical, close

# Scroll through existing workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, m-1
bind = $mainMod, mouse_up, workspace, m+1
# Switch workspace by side button
bind = , mouse:276, workspace, m-1
bind = , mouse:275, workspace, m+1

# Add new workspace at next lowest number workspace
bind = $mainMod, backslash, exec, hypr-addws
bind = $mainMod, G, exec, hypr-addws
bind = $mainMod, semicolon, exec, hypr-addws

# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Screenshot
bind = , PRINT, exec, $run -- screenshot fullscreen
bind = SHIFT, PRINT, exec, $run -- screenshot window
bind = CONTROL, PRINT, exec, $run -- screenshot region

# Configure gaps/borders on sub-monitor
workspace = m[HDMI-A-3], gapsout:12 12 20 12

# *** Application Rules ***
# Launcher
windowrulev2 = float,class:^(sklauncher)$
windowrulev2 = center,class:^(sklauncher)$
windowrulev2 = size 800 920,class:^(sklauncher)$
windowrulev2 = pin,class:^(findex)$
windowrulev2 = stayfocused,class:^(findex)$
windowrulev2 = stayfocused,class:^(albert)$
windowrulev2 = float,class:^(albert)$
windowrulev2 = center,class:^(albert)$
windowrulev2 = dimaround,class:^(albert)$

# Logseq
workspace = special:logseq, gapsout:120 360 120 360
windowrulev2 = workspace special:logseq,class:^(Logseq)$
# windowrulev2 = opacity 0.95,class:^(Logseq)$

# ScratchTerm
workspace = special:scratchterm-dp1, gapsout:120 360 120 360
workspace = special:scratchterm-dp2, gapsout:120 240 120 240
windowrulev2 = workspace special:scratchterm-dp1,class:^(.*scratchterm-dp1)$
windowrulev2 = workspace special:scratchterm-dp2,class:^(.*scratchterm-dp2)$

# Browser
windowrulev2 = workspace $ws01 silent,class:^(zen)$
windowrulev2 = workspace $ws01 silent,class:^(zen-twilight)$
windowrulev2 = workspace $ws01 silent,class:^(app.zen_browser.zen)$
windowrulev2 = workspace $ws01 silent,class:^(firefox)$
windowrulev2 = workspace $ws11 silent,class:^(firefox-sub)$
windowrulev2 = workspace $ws11 silent,class:^(org.mozilla.firefox)$
windowrulev2 = workspace $ws01 silent,class:^(vivaldi-stable)$
windowrulev2 = workspace $ws01 silent,class:^(Vivaldi-stable)$
# workspace = name:$ws01, gapsin:0, gapsout:0, rounding:false, border:false, shadow:false  # disable eye-candies for main browser
# workspace = name:$ws11, gapsin:0, gapsout:0, rounding:false, border:false, shadow:false  # disable eye-candies for sub browser
windowrulev2 = tile,class:^(firefox)$
windowrulev2 = tile,class:^(firefox-sub)$
windowrulev2 = tile,class:^(vivaldi-stable)$
windowrulev2 = tile,class:^(Vivaldi-stable)$
windowrulev2 = workspace $ws12 silent,class:^(chrom.*-game)$
windowrulev2 = renderunfocused,class:^(chrom.*-game)$
windowrulev2 = workspace $ws13 silent,class:^(Vivaldi-home)$
windowrulev2 = tile,class:^(Vivaldi-home)$
windowrulev2 = workspace $ws14 silent,class:^(discord)$
windowrulev2 = workspace $ws14 silent,class:^(vesktop)$

# Media Player
windowrulev2 = nodim,class:^(mpv)$
windowrulev2 = workspace $ws09 silent,class:^([Ss]potify)$
windowrulev2 = workspace $ws09 silent,class:^([Qq]obuz)$
windowrulev2 = tile,class:^([Ss]potify)$
windowrulev2 = opacity 0.95,class:^([Ss]potify)$
windowrulev2 = workspace $ws09 silent,class:^(.*spotify-player)$
windowrulev2 = workspace $ws09 silent,class:^(audacious)$
windowrulev2 = workspace $ws09 silent,class:^(upplay)$

# Steam / Proton
windowrulev2 = workspace $ws07 silent,class:^(steam)$
windowrulev2 = workspace $ws07 silent,class:^(steamwebhelper)$
windowrulev2 = workspace $ws07 silent,class:^(Steam)$
windowrulev2 = workspace $ws07 silent,title:^(ProtonUp-Qt)$
windowrulev2 = float,class:^(gamescope)$
windowrulev2 = noblur,class:^(gamescope)$
windowrulev2 = nodim,class:^(gamescope)$
windowrulev2 = idleinhibit fullscreen,class:^(gamescope)$
windowrulev2 = workspace $ws08 silent,class:^(gamescope)$
windowrulev2 = noblur,class:^(steam_app_.*)$
windowrulev2 = idleinhibit focus,class:^(steam_app_.*)$
windowrulev2 = workspace $ws08 silent,class:^(steam_app_.*)$
windowrulev2 = noblur,class:^(steam_proton)$
windowrulev2 = nodim,class:^(steam_proton)$
windowrulev2 = idleinhibit focus,class:^(steam_proton)$
windowrulev2 = workspace $ws08 silent,class:^(steam_proton)$

# misc
windowrulev2 = float,class:^(org.pulseaudio.pavucontrol)$
windowrulev2 = float,class:^(pavucontrol-qt)$
windowrulev2 = float,class:^(XEyes)$

# layer
layerrule = order 1, qs-desktop

# enable blur for tofi and walker
layerrule = blur, launcher

# *** Plugins ***
